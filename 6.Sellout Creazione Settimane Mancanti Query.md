## Query Batch 6 Creazione settimane mancanti

### Query1 Estrazione Week per Gruppo
```sql
SELECT DISTINCT(SUBSTR(KEY_ELEM,1,3)) AS GRUPPO
, A.AASS
, A.AAMM
FROM  TBORSLOW A
INNER JOIN NOPROD.TBOCLAC  B
ON A.PART_IVA  = B.TAX_NUM2_PI
AND B.CMPNY_COD  = 'IT16'
INNER JOIN NOPROD.TBNOWACL C
ON A.SOC_COD  =C.SOC_COD
AND B.CUSTID  =C.CUSTID
INNER JOIN ORPROD.TBORWCPA D
ON C.SOC_COD = D.SOC_COD
AND C.CUSTID  = D.CUSTID
INNER JOIN ORPROD.TBORTAB E
ON D.SOC_COD = E.SOC_COD
AND E.TABLE_NAME  = 'OCPCG'
AND SUBSTR(E.ELEM,1,11)  = A.PART_IVA
WHERE  A.AAMM  BETWEEN :AAMM-DA
AND :AAMM-A
AND  A.APP_COD_CLI  <> '9999999990'
AND  A.SOC_COD  = :SOC-COD
AND D.SELL_OUT  ='GGG'
```
### Query2 Estrazione Partite Iva per Gruppo
```sql
SELECT A.TAX_NUM2_PI
, MIN(E.PDV_COD_ELUX)
FROM  TBNOCLAC  A
INNER JOIN ORPROD.TBORTAB B
ON B.SOC_COD = :SOC_COD
AND B.TABLE_NAME  = 'OCPCG'
AND SUBSTR(B.ELEM,1,11)  = A.TAX_NUM2_PI
INNER JOIN NOPROD.TBNOWACL C
ON A.SOC_COD  = C.SOC_COD
AND A.CUST_COD  = C.CUST_COD
INNER JOIN ORPROD.TBORWCPA D
ON C.SOC_COD = D.SOC_COD
AND C.CUSTID  = D.CUSTID
INNER JOIN NOPROD.TBORSLOA E
ON A.TAX_NUM2_PI  = E.PART_IVA
WHERE A.SOC_COD  = :SOC-COD
AND D.SELL_OUT  ='GGG'
AND SUBSTR(B.KEY_ELEM,1,3)= :GRUPPO
GROUP BY A.TAX_NUM2_PI
```
### Query3 Estrazione Week per Singolo Socio
```sql
SELECT DISTINCT(A.PART_IVA)
, A.AASS
, A.AAMM
FROM  TBORSLOW A
INNER JOIN NOPROD.TBOCLAC  B
ON A.PART_IVA  = B.TAX_NUM2_PI
AND B.CMPNY_COD  = 'IT16'
INNER JOIN NOPROD.TBNOWACL C
ON A.SOC_COD  =C.SOC_COD
AND B.CUSTID  =C.CUSTID
INNER JOIN ORPROD.TBORWCPA D
ON C.SOC_COD = D.SOC_COD
AND C.CUSTID  = D.CUSTID
WHERE  A.AAMM  BETWEEN :AAMM-DA
AND :AAMM-A
AND  A.APP_COD_CLI  <> '9999999990'
AND  A.SOC_COD  = :SOC-COD
AND D.SELL_OUT  NOT IN ('XXX','GGG','  ')
```
### Query4 Estrazione Pdv per Partita iva
```sql
SELECT MIN(PDV_COD_ELUX)
FROM  TBORSLOA
WHERE TAX_NUM2_PI= :PARTITA_IVA
```
### Query5 Cancellazione Week mancanti
```sql
DELETE TBORSLOW
WHERE  AAMM
BETWEEN :AAMM-DA
AND :AAMM-A
AND  APP_COD_CLI  = '9999999990'
AND  SOC_COD  = :SOC-COD
```
### Query6 Estrazione week mancanti per segnalazione via mail
```sql
SELECT DISTINCT(A.PART_IVA)
, F.CUST_NAME_1
, COALESCE(SUBSTR(D.ELEM, 1, 25),'  ') as GRUPPO
, COALESCE(SUBSTR(D.ELEM, 27, 3),'  ') AS FUNZ_COD
, A.AASS
, A.AAMM
FROM  TBORSLOW A
INNER JOIN  TBNOCLAC  B
ON  A.PART_IVA  = B.TAX_NUM2_PI
AND  B.CMPNY_COD  = 'IT16'
INNER JOIN  TBNOCUST  C
ON  C.SOC_COD  = :SOC_COD
AND C.CUST_COD  = B.CUST_COD
INNER JOIN TBORTAB  D
ON  D.SOC_COD  = :SOC-COD
AND  D.TABLE_NAME = 'OCGRC'
AND  D.KEY_ELEM  = C.CANALE
INNER JOIN  TBNOCLAP  E
ON  E.CMPNY_COD  =  B.CMPNY_COD
AND  E.SALES_ORG  = 'IT16'
AND  E.DISTR_CHN  = '01'
AND  E.DIV  = '01'
AND  E.CUST_COD  =  B.CUST_COD
AND  E.PRTNR_FUNC  = 'PY'
INNER JOIN  TBNOCLAC  F
ON  F.CMPNY_COD  =  E.CMPNY_COD
AND  F.CUST_COD  =  E.CUST_COD_PRTNR
WHERE  A.AAMM  BETWEEN :AAMM-DA
AND :AAMM-A
AND  A.APP_COD_CLI  = '9999999990'
AND  A.SOC_COD  = :SOC-COD
ORDER BY  4,3,1,5
```
